(function(a){'use strict';'function'==typeof define&&define.amd?define(['jquery','load-image','load-image-meta','load-image-scale','load-image-exif','canvas-to-blob','./jquery.fileupload-process'],a):'object'==typeof exports?a(require('jquery'),require('blueimp-load-image/js/load-image'),require('blueimp-load-image/js/load-image-meta'),require('blueimp-load-image/js/load-image-scale'),require('blueimp-load-image/js/load-image-exif'),require('blueimp-canvas-to-blob'),require('./jquery.fileupload-process')):a(window.jQuery,window.loadImage)})(function(a,b){'use strict';a.blueimp.fileupload.prototype.options.processQueue.unshift({action:'loadImageMetaData',disableImageHead:'@',disableExif:'@',disableExifThumbnail:'@',disableExifSub:'@',disableExifGps:'@',disabled:'@disableImageMetaDataLoad'},{action:'loadImage',prefix:!0,fileTypes:'@',maxFileSize:'@',noRevoke:'@',disabled:'@disableImageLoad'},{action:'resizeImage',prefix:'image',maxWidth:'@',maxHeight:'@',minWidth:'@',minHeight:'@',crop:'@',orientation:'@',forceResize:'@',disabled:'@disableImageResize'},{action:'saveImage',quality:'@imageQuality',type:'@imageType',disabled:'@disableImageResize'},{action:'saveImageMetaData',disabled:'@disableImageMetaDataSave'},{action:'resizeImage',prefix:'preview',maxWidth:'@',maxHeight:'@',minWidth:'@',minHeight:'@',crop:'@',orientation:'@',thumbnail:'@',canvas:'@',disabled:'@disableImagePreview'},{action:'setImage',name:'@imagePreviewName',disabled:'@disableImagePreview'},{action:'deleteImageReferences',disabled:'@disableImageReferencesDeletion'}),a.widget('blueimp.fileupload',a.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png|svg\+xml)$/,loadImageMaxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:!1,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(c,d){if(d.disabled)return c;var e=this,f=c.files[c.index],g=a.Deferred();return'number'===a.type(d.maxFileSize)&&f.size>d.maxFileSize||d.fileTypes&&!d.fileTypes.test(f.type)||!b(f,function(h){h.src&&(c.img=h),g.resolveWith(e,[c])},d)?c:g.promise()},resizeImage:function(c,d){if(d.disabled||!(c.canvas||c.img))return c;d=a.extend({canvas:!0},d);var i,e=this,f=a.Deferred(),g=d.canvas&&c.canvas||c.img,h=function(j){j&&(j.width!==g.width||j.height!==g.height||d.forceResize)&&(c[j.getContext?'canvas':'img']=j),c.preview=j,f.resolveWith(e,[c])};if(c.exif){if(!0===d.orientation&&(d.orientation=c.exif.get('Orientation')),d.thumbnail&&(i=c.exif.get('Thumbnail'),i))return b(i,h,d),f.promise();c.orientation?delete d.orientation:c.orientation=d.orientation}return g?(h(b.scale(g,d)),f.promise()):c},saveImage:function(c,d){if(!c.canvas||d.disabled)return c;var e=this,f=c.files[c.index],g=a.Deferred();if(c.canvas.toBlob)c.canvas.toBlob(function(h){h.name||(f.type===h.type?h.name=f.name:f.name&&(h.name=f.name.replace(/\.\w+$/,'.'+h.type.substr(6)))),f.type!==h.type&&delete c.imageHead,c.files[c.index]=h,g.resolveWith(e,[c])},d.type||f.type,d.quality);else return c;return g.promise()},loadImageMetaData:function(c,d){if(d.disabled)return c;var e=this,f=a.Deferred();return b.parseMetaData(c.files[c.index],function(g){a.extend(c,g),f.resolveWith(e,[c])},d),f.promise()},saveImageMetaData:function(c,d){if(!(c.imageHead&&c.canvas&&c.canvas.toBlob&&!d.disabled))return c;var e=c.files[c.index],f=new Blob([c.imageHead,this._blobSlice.call(e,20)],{type:e.type});return f.name=e.name,c.files[c.index]=f,c},setImage:function(c,d){return c.preview&&!d.disabled&&(c.files[c.index][d.name||'preview']=c.preview),c},deleteImageReferences:function(c,d){return d.disabled||(delete c.img,delete c.canvas,delete c.preview,delete c.imageHead),c}}})});
