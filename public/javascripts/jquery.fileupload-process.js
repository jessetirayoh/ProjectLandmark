(function(a){'use strict';'function'==typeof define&&define.amd?define(['jquery','./jquery.fileupload'],a):'object'==typeof exports?a(require('jquery'),require('./jquery.fileupload')):a(window.jQuery)})(function(a){'use strict';var b=a.blueimp.fileupload.prototype.options.add;a.widget('blueimp.fileupload',a.blueimp.fileupload,{options:{processQueue:[],add:function(c,d){var f=a(this);d.process(function(){return f.fileupload('process',d)}),b.call(this,c,d)}},processActions:{},_processFile:function(c,d){var f=this,g=a.Deferred().resolveWith(f,[c]),h=g.promise();return this._trigger('process',null,c),a.each(c.processQueue,function(j,k){var l=function(m){return d.errorThrown?a.Deferred().rejectWith(f,[d]).promise():f.processActions[k.action].call(f,m,k)};h=h.then(l,k.always&&l)}),h.done(function(){f._trigger('processdone',null,c),f._trigger('processalways',null,c)}).fail(function(){f._trigger('processfail',null,c),f._trigger('processalways',null,c)}),h},_transformProcessQueue:function(c){var d=[];a.each(c.processQueue,function(){var f={},g=this.action,h=!0===this.prefix?g:this.prefix;a.each(this,function(j,k){f[j]='string'===a.type(k)&&'@'===k.charAt(0)?c[k.slice(1)||(h?h+j.charAt(0).toUpperCase()+j.slice(1):j)]:k}),d.push(f)}),c.processQueue=d},processing:function(){return this._processing},process:function(c){var d=this,f=a.extend({},this.options,c);return f.processQueue&&f.processQueue.length&&(this._transformProcessQueue(f),0===this._processing&&this._trigger('processstart'),a.each(c.files,function(g){var h=g?a.extend({},f):f,j=function(){return c.errorThrown?a.Deferred().rejectWith(d,[c]).promise():d._processFile(h,c)};h.index=g,d._processing+=1,d._processingQueue=d._processingQueue.then(j,j).always(function(){d._processing-=1,0===d._processing&&d._trigger('processstop')})})),this._processingQueue},_create:function(){this._super(),this._processing=0,this._processingQueue=a.Deferred().resolveWith(this).promise()}})});
