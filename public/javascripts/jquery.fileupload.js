(function(a){'use strict';'function'==typeof define&&define.amd?define(['jquery','jquery-ui/ui/widget'],a):'object'==typeof exports?a(require('jquery'),require('./vendor/jquery.ui.widget')):a(window.jQuery)})(function(a){'use strict';function b(c){return function(f){f.dataTransfer=f.originalEvent&&f.originalEvent.dataTransfer;var g=f.dataTransfer;g&&-1!==a.inArray('Files',g.types)&&!1!==this._trigger(c,a.Event(c,{delegatedEvent:f}))&&(f.preventDefault(),'dragover'===c&&(g.dropEffect='copy'))}}a.support.fileInput=!(/(Android (1\.[0156]|2\.[01]))|(Windows Phone (OS 7|8\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1\.0|2\.[05]|3\.0))/.test(window.navigator.userAgent)||a('<input type="file">').prop('disabled')),a.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader),a.support.xhrFormDataFileUpload=!!window.FormData,a.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),a.widget('blueimp.fileupload',{options:{dropZone:a(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:'Uploaded bytes exceed file size'},i18n:function(c,d){return c=this.messages[c]||c.toString(),d&&a.each(d,function(f,g){c=c.replace('{'+f+'}',g)}),c},formData:function(c){return c.serializeArray()},add:function(c,d){return!c.isDefaultPrevented()&&void((d.autoUpload||!1!==d.autoUpload&&a(this).fileupload('option','autoUpload'))&&d.process().done(function(){d.submit()}))},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:['fileInput','dropZone','pasteZone','multipart','forceIframeTransport'],_blobSlice:a.support.blobSlice&&function(){var c=this.slice||this.webkitSlice||this.mozSlice;return c.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():new Date().getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(c,d,f){var g=c-this.timestamp;return this.bitrate&&f&&!(g>f)||(this.bitrate=8*((d-this.loaded)*(1e3/g)),this.loaded=d,this.timestamp=c),this.bitrate}},_isXHRUpload:function(c){return!c.forceIframeTransport&&(!c.multipart&&a.support.xhrFileUpload||a.support.xhrFormDataFileUpload)},_getFormData:function(c){var d;return'function'===a.type(c.formData)?c.formData(c.form):a.isArray(c.formData)?c.formData:'object'===a.type(c.formData)?(d=[],a.each(c.formData,function(f,g){d.push({name:f,value:g})}),d):[]},_getTotal:function(c){var d=0;return a.each(c,function(f,g){d+=g.size||1}),d},_initProgressObject:function(c){var d={loaded:0,total:0,bitrate:0};c._progress?a.extend(c._progress,d):c._progress=d},_initResponseObject:function(c){if(c._response)for(var d in c._response)c._response.hasOwnProperty(d)&&delete c._response[d];else c._response={}},_onProgress:function(c,d){if(c.lengthComputable){var g,f=Date.now?Date.now():new Date().getTime();if(d._time&&d.progressInterval&&f-d._time<d.progressInterval&&c.loaded!==c.total)return;d._time=f,g=Math.floor(c.loaded/c.total*(d.chunkSize||d._progress.total))+(d.uploadedBytes||0),this._progress.loaded+=g-d._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(f,this._progress.loaded,d.bitrateInterval),d._progress.loaded=d.loaded=g,d._progress.bitrate=d.bitrate=d._bitrateTimer.getBitrate(f,g,d.bitrateInterval),this._trigger('progress',a.Event('progress',{delegatedEvent:c}),d),this._trigger('progressall',a.Event('progressall',{delegatedEvent:c}),this._progress)}},_initProgressListener:function(c){var d=this,f=c.xhr?c.xhr():a.ajaxSettings.xhr();f.upload&&(a(f.upload).bind('progress',function(g){var h=g.originalEvent;g.lengthComputable=h.lengthComputable,g.loaded=h.loaded,g.total=h.total,d._onProgress(g,c)}),c.xhr=function(){return f})},_isInstanceOf:function(c,d){return Object.prototype.toString.call(d)==='[object '+c+']'},_initXHRData:function(c){var f,d=this,g=c.files[0],h=c.multipart||!a.support.xhrFileUpload,k='array'===a.type(c.paramName)?c.paramName[0]:c.paramName;c.headers=a.extend({},c.headers),c.contentRange&&(c.headers['Content-Range']=c.contentRange),h&&!c.blob&&this._isInstanceOf('File',g)||(c.headers['Content-Disposition']='attachment; filename="'+encodeURI(g.name)+'"'),h?a.support.xhrFormDataFileUpload&&(c.postMessage?(f=this._getFormData(c),c.blob?f.push({name:k,value:c.blob}):a.each(c.files,function(l,m){f.push({name:'array'===a.type(c.paramName)&&c.paramName[l]||k,value:m})})):(d._isInstanceOf('FormData',c.formData)?f=c.formData:(f=new FormData,a.each(this._getFormData(c),function(l,m){f.append(m.name,m.value)})),c.blob?f.append(k,c.blob,g.name):a.each(c.files,function(l,m){(d._isInstanceOf('File',m)||d._isInstanceOf('Blob',m))&&f.append('array'===a.type(c.paramName)&&c.paramName[l]||k,m,m.uploadName||m.name)})),c.data=f):(c.contentType=g.type||'application/octet-stream',c.data=c.blob||g),c.blob=null},_initIframeSettings:function(c){var d=a('<a></a>').prop('href',c.url).prop('host');c.dataType='iframe '+(c.dataType||''),c.formData=this._getFormData(c),c.redirect&&d&&d!==location.host&&c.formData.push({name:c.redirectParamName||'redirect',value:c.redirect})},_initDataSettings:function(c){this._isXHRUpload(c)?(!this._chunkedUpload(c,!0)&&(!c.data&&this._initXHRData(c),this._initProgressListener(c)),c.postMessage&&(c.dataType='postmessage '+(c.dataType||''))):this._initIframeSettings(c)},_getParamName:function(c){var d=a(c.fileInput),f=c.paramName;return f?!a.isArray(f)&&(f=[f]):(f=[],d.each(function(){for(var g=a(this),h=g.prop('name')||'files[]',k=(g.prop('files')||[1]).length;k;)f.push(h),k-=1}),!f.length&&(f=[d.prop('name')||'files[]'])),f},_initFormSettings:function(c){c.form&&c.form.length||(c.form=a(c.fileInput.prop('form')),!c.form.length&&(c.form=a(this.options.fileInput.prop('form')))),c.paramName=this._getParamName(c),c.url||(c.url=c.form.prop('action')||location.href),c.type=(c.type||'string'===a.type(c.form.prop('method'))&&c.form.prop('method')||'').toUpperCase(),'POST'!==c.type&&'PUT'!==c.type&&'PATCH'!==c.type&&(c.type='POST'),c.formAcceptCharset||(c.formAcceptCharset=c.form.attr('accept-charset'))},_getAJAXSettings:function(c){var d=a.extend({},this.options,c);return this._initFormSettings(d),this._initDataSettings(d),d},_getDeferredState:function(c){return c.state?c.state():c.isResolved()?'resolved':c.isRejected()?'rejected':'pending'},_enhancePromise:function(c){return c.success=c.done,c.error=c.fail,c.complete=c.always,c},_getXHRPromise:function(c,d,f){var g=a.Deferred(),h=g.promise();return d=d||this.options.context||h,!0===c?g.resolveWith(d,f):!1==c&&g.rejectWith(d,f),h.abort=g.promise,this._enhancePromise(h)},_addConvenienceMethods:function(c,d){var f=this,g=function(h){return a.Deferred().resolveWith(f,h).promise()};d.process=function(h,k){return(h||k)&&(d._processQueue=this._processQueue=(this._processQueue||g([this])).then(function(){return d.errorThrown?a.Deferred().rejectWith(f,[d]).promise():g(arguments)}).then(h,k)),this._processQueue||g([this])},d.submit=function(){return'pending'!==this.state()&&(d.jqXHR=this.jqXHR=!1!==f._trigger('submit',a.Event('submit',{delegatedEvent:c}),this)&&f._onSend(c,this)),this.jqXHR||f._getXHRPromise()},d.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown='abort',f._trigger('fail',null,this),f._getXHRPromise(!1))},d.state=function(){return this.jqXHR?f._getDeferredState(this.jqXHR):this._processQueue?f._getDeferredState(this._processQueue):void 0},d.processing=function(){return!this.jqXHR&&this._processQueue&&'pending'===f._getDeferredState(this._processQueue)},d.progress=function(){return this._progress},d.response=function(){return this._response}},_getUploadedBytes:function(c){var d=c.getResponseHeader('Range'),f=d&&d.split('-'),g=f&&1<f.length&&parseInt(f[1],10);return g&&g+1},_chunkedUpload:function(c,d){c.uploadedBytes=c.uploadedBytes||0;var q,r,f=this,g=c.files[0],h=g.size,k=c.uploadedBytes,l=c.maxChunkSize||h,m=this._blobSlice,n=a.Deferred(),p=n.promise();return!(this._isXHRUpload(c)&&m&&(k||('function'===a.type(l)?l(c):l)<h))||c.data?!1:!!d||(k>=h?(g.error=c.i18n('uploadedBytes'),this._getXHRPromise(!1,c.context,[null,'error',g.error])):(r=function(){var s=a.extend({},c),t=s._progress.loaded;s.blob=m.call(g,k,k+('function'===a.type(l)?l(s):l),g.type),s.chunkSize=s.blob.size,s.contentRange='bytes '+k+'-'+(k+s.chunkSize-1)+'/'+h,f._initXHRData(s),f._initProgressListener(s),q=(!1!==f._trigger('chunksend',null,s)&&a.ajax(s)||f._getXHRPromise(!1,s.context)).done(function(u,v,w){k=f._getUploadedBytes(w)||k+s.chunkSize,t+s.chunkSize-s._progress.loaded&&f._onProgress(a.Event('progress',{lengthComputable:!0,loaded:k-s.uploadedBytes,total:k-s.uploadedBytes}),s),c.uploadedBytes=s.uploadedBytes=k,s.result=u,s.textStatus=v,s.jqXHR=w,f._trigger('chunkdone',null,s),f._trigger('chunkalways',null,s),k<h?r():n.resolveWith(s.context,[u,v,w])}).fail(function(u,v,w){s.jqXHR=u,s.textStatus=v,s.errorThrown=w,f._trigger('chunkfail',null,s),f._trigger('chunkalways',null,s),n.rejectWith(s.context,[u,v,w])})},this._enhancePromise(p),p.abort=function(){return q.abort()},r(),p))},_beforeSend:function(c,d){0===this._active&&(this._trigger('start'),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(d),this._initProgressObject(d),d._progress.loaded=d.loaded=d.uploadedBytes||0,d._progress.total=d.total=this._getTotal(d.files)||1,d._progress.bitrate=d.bitrate=0,this._active+=1,this._progress.loaded+=d.loaded,this._progress.total+=d.total},_onDone:function(c,d,f,g){var h=g._progress.total,k=g._response;g._progress.loaded<h&&this._onProgress(a.Event('progress',{lengthComputable:!0,loaded:h,total:h}),g),k.result=g.result=c,k.textStatus=g.textStatus=d,k.jqXHR=g.jqXHR=f,this._trigger('done',null,g)},_onFail:function(c,d,f,g){var h=g._response;g.recalculateProgress&&(this._progress.loaded-=g._progress.loaded,this._progress.total-=g._progress.total),h.jqXHR=g.jqXHR=c,h.textStatus=g.textStatus=d,h.errorThrown=g.errorThrown=f,this._trigger('fail',null,g)},_onAlways:function(c,d,f,g){this._trigger('always',null,g)},_onSend:function(c,d){d.submit||this._addConvenienceMethods(c,d);var g,h,k,l,f=this,m=f._getAJAXSettings(d),n=function(){return f._sending+=1,m._bitrateTimer=new f._BitrateTimer,g=g||((h||!1===f._trigger('send',a.Event('send',{delegatedEvent:c}),m))&&f._getXHRPromise(!1,m.context,h)||f._chunkedUpload(m)||a.ajax(m)).done(function(p,q,r){f._onDone(p,q,r,m)}).fail(function(p,q,r){f._onFail(p,q,r,m)}).always(function(p,q,r){if(f._onAlways(p,q,r,m),f._sending-=1,f._active-=1,m.limitConcurrentUploads&&m.limitConcurrentUploads>f._sending)for(var s=f._slots.shift();s;){if('pending'===f._getDeferredState(s)){s.resolve();break}s=f._slots.shift()}0===f._active&&f._trigger('stop')}),g};return this._beforeSend(c,m),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(1<this.options.limitConcurrentUploads?(k=a.Deferred(),this._slots.push(k),l=k.then(n)):(this._sequence=this._sequence.then(n,n),l=this._sequence),l.abort=function(){return h=[void 0,'abort','abort'],g?g.abort():(k&&k.rejectWith(m.context,h),n())},this._enhancePromise(l)):n()},_onAdd:function(c,d){var s,t,u,v,f=this,g=!0,h=a.extend({},this.options,d),k=d.files,l=k.length,m=h.limitMultiFileUploads,n=h.limitMultiFileUploadSize,p=h.limitMultiFileUploadSizeOverhead,q=0,r=this._getParamName(h),w=0;if(!l)return!1;if(n&&void 0===k[0].size&&(n=void 0),!(h.singleFileUploads||m||n)||!this._isXHRUpload(h))u=[k],s=[r];else if(!(h.singleFileUploads||n)&&m)for(u=[],s=[],v=0;v<l;v+=m)u.push(k.slice(v,v+m)),t=r.slice(v,v+m),t.length||(t=r),s.push(t);else if(!h.singleFileUploads&&n)for(u=[],s=[],v=0;v<l;++v)q+=k[v].size+p,(v+1===l||q+k[v+1].size+p>n||m&&v+1-w>=m)&&(u.push(k.slice(w,v+1)),t=r.slice(w,v+1),!t.length&&(t=r),s.push(t),w=v+1,q=0);else s=r;return d.originalFiles=k,a.each(u||k,function(x,y){var z=a.extend({},d);return z.files=u?y:[y],z.paramName=s[x],f._initResponseObject(z),f._initProgressObject(z),f._addConvenienceMethods(c,z),g=f._trigger('add',a.Event('add',{delegatedEvent:c}),z),g}),g},_replaceFileInput:function(c){var d=c.fileInput,f=d.clone(!0),g=d.is(document.activeElement);c.fileInputClone=f,a('<form></form>').append(f)[0].reset(),d.after(f).detach(),g&&f.focus(),a.cleanData(d.unbind('remove')),this.options.fileInput=this.options.fileInput.map(function(h,k){return k===d[0]?f[0]:k}),d[0]===this.element[0]&&(this.element=f)},_handleFileTreeEntry:function(c,d){var k,f=this,g=a.Deferred(),h=[],l=function(p){p&&!p.entry&&(p.entry=c),g.resolve([p])},m=function(p){f._handleFileTreeEntries(p,d+c.name+'/').done(function(q){g.resolve(q)}).fail(l)},n=function(){k.readEntries(function(p){p.length?(h=h.concat(p),n()):m(h)},l)};return d=d||'',c.isFile?c._file?(c._file.relativePath=d,g.resolve(c._file)):c.file(function(p){p.relativePath=d,g.resolve(p)},l):c.isDirectory?(k=c.createReader(),n()):g.resolve([]),g.promise()},_handleFileTreeEntries:function(c,d){var f=this;return a.when.apply(a,a.map(c,function(g){return f._handleFileTreeEntry(g,d)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(c){c=c||{};var d=c.items;return d&&d.length&&(d[0].webkitGetAsEntry||d[0].getAsEntry)?this._handleFileTreeEntries(a.map(d,function(f){var g;return f.webkitGetAsEntry?(g=f.webkitGetAsEntry(),g&&(g._file=f.getAsFile()),g):f.getAsEntry()})):a.Deferred().resolve(a.makeArray(c.files)).promise()},_getSingleFileInputFiles:function(c){c=a(c);var f,g,d=c.prop('webkitEntries')||c.prop('entries');if(d&&d.length)return this._handleFileTreeEntries(d);if(f=a.makeArray(c.prop('files')),!f.length){if(g=c.prop('value'),!g)return a.Deferred().resolve([]).promise();f=[{name:g.replace(/^.*\\/,'')}]}else void 0===f[0].name&&f[0].fileName&&a.each(f,function(h,k){k.name=k.fileName,k.size=k.fileSize});return a.Deferred().resolve(f).promise()},_getFileInputFiles:function(c){return c instanceof a&&1!==c.length?a.when.apply(a,a.map(c,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(c)},_onChange:function(c){var d=this,f={fileInput:a(c.target),form:a(c.target.form)};this._getFileInputFiles(f.fileInput).always(function(g){f.files=g,d.options.replaceFileInput&&d._replaceFileInput(f),!1!==d._trigger('change',a.Event('change',{delegatedEvent:c}),f)&&d._onAdd(c,f)})},_onPaste:function(c){var d=c.originalEvent&&c.originalEvent.clipboardData&&c.originalEvent.clipboardData.items,f={files:[]};d&&d.length&&(a.each(d,function(g,h){var k=h.getAsFile&&h.getAsFile();k&&f.files.push(k)}),!1!==this._trigger('paste',a.Event('paste',{delegatedEvent:c}),f)&&this._onAdd(c,f))},_onDrop:function(c){c.dataTransfer=c.originalEvent&&c.originalEvent.dataTransfer;var d=this,f=c.dataTransfer,g={};f&&f.files&&f.files.length&&(c.preventDefault(),this._getDroppedFiles(f).always(function(h){g.files=h,!1!==d._trigger('drop',a.Event('drop',{delegatedEvent:c}),g)&&d._onAdd(c,g)}))},_onDragOver:b('dragover'),_onDragEnter:b('dragenter'),_onDragLeave:b('dragleave'),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),a.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,'dragenter dragleave dragover drop'),this._off(this.options.pasteZone,'paste'),this._off(this.options.fileInput,'change')},_destroy:function(){this._destroyEventHandlers()},_setOption:function(c,d){var f=-1!==a.inArray(c,this._specialOptions);f&&this._destroyEventHandlers(),this._super(c,d),f&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var c=this.options;c.fileInput===void 0?c.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):!(c.fileInput instanceof a)&&(c.fileInput=a(c.fileInput)),c.dropZone instanceof a||(c.dropZone=a(c.dropZone)),c.pasteZone instanceof a||(c.pasteZone=a(c.pasteZone))},_getRegExp:function(c){var d=c.split('/'),f=d.pop();return d.shift(),new RegExp(d.join('/'),f)},_isRegExpOption:function(c,d){return'url'!==c&&'string'===a.type(d)&&/^\/.*\/[igm]{0,3}$/.test(d)},_initDataAttributes:function(){var c=this,d=this.options,f=this.element.data();a.each(this.element[0].attributes,function(g,h){var l,k=h.name.toLowerCase();/^data-/.test(k)&&(k=k.slice(5).replace(/-[a-z]/g,function(m){return m.charAt(1).toUpperCase()}),l=f[k],c._isRegExpOption(k,l)&&(l=c._getRegExp(l)),d[k]=l)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(c){var d=this;!c||this.options.disabled||(c.fileInput&&!c.files?this._getFileInputFiles(c.fileInput).always(function(f){c.files=f,d._onAdd(null,c)}):(c.files=a.makeArray(c.files),this._onAdd(null,c)))},send:function(c){if(c&&!this.options.disabled){if(c.fileInput&&!c.files){var h,k,d=this,f=a.Deferred(),g=f.promise();return g.abort=function(){return(k=!0,h)?h.abort():(f.reject(null,'abort','abort'),g)},this._getFileInputFiles(c.fileInput).always(function(l){return k?void 0:l.length?void(c.files=l,h=d._onSend(null,c),h.then(function(m,n,p){f.resolve(m,n,p)},function(m,n,p){f.reject(m,n,p)})):void f.reject()}),this._enhancePromise(g)}if(c.files=a.makeArray(c.files),c.files.length)return this._onSend(null,c)}return this._getXHRPromise(!1,c&&c.context)}})});
